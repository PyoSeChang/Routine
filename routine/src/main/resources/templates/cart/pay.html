<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      lang="ko">
<head>
    <header style="
    width: 100%;
    color: white;
    padding: 12px 24px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    background-color: #724019;
    background-image: url('https://www.transparenttextures.com/patterns/dark-wood.png');
    background-repeat: repeat;
">
        <div style="
        max-width: 96rem;
        margin: 0 auto;
        display: flex;
        align-items: center;
        justify-content: space-between;
    ">
            <h1 style="font-size: 32px; font-weight: bold;">
                <a href="http://localhost:3000/" style="color: white; text-decoration: none;">Routine</a>
            </h1>
            <nav style="display: inline-block;">
                <span>|</span>
                <a href="http://localhost:8080/product/list" target="_blank" rel="noopener noreferrer" style="color: white; text-decoration: none; margin: 0 8px;">Shop</a>
                <span>|</span>
                <a href="http://localhost:3000/boards" style="color: white; text-decoration: none; margin: 0 8px;">Community</a>
                <span>|</span>
                <a href="http://localhost:3000/circles" style="color: white; text-decoration: none; margin: 0 8px;">Circle</a>
                <span>|</span>
                <a href="http://localhost:3000/routine" style="color: white; text-decoration: none; margin: 0 8px;">My Routines</a>
                <span>|</span>
                <a href="http://localhost:3000/login" style="color: white; text-decoration: none; margin: 0 8px;">Login</a>
                <span>|</span>
            </nav>
        </div>
    </header>

    <meta charset="UTF-8">
<!--    <title>ê²°ì œ ì •ë³´ í™•ì¸ - í¬ìŠ¤íŠ¸ì‡ ìŠ¤íƒ€ì¼</title>-->

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/style.css" rel="stylesheet">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Gamja+Flower&display=swap');

        body {
            font-family: 'Poppins',sans-serif;
            background-color: #f9f3c3;
            background-image: url('/images/abc.jpg');
            background-size: cover;
            background-attachment: fixed;
            /*padding-top: 30px;*/
        }

        h2 {
            font-size: 2.5rem;
            color: white;
            text-align: center;
            margin-bottom: 30px;
        }

        .postit-board {
            background-color: #fffab3;
            border: 3px dashed #f4c542;
            border-radius: 20px;
            box-shadow: 5px 5px 10px rgba(0,0,0,0.15);
            padding: 30px;
            margin-bottom: 40px;
        }

        .card-title {
            font-size: 1.6rem;
            color: #4b4b4b;
            margin-bottom: 20px;
        }

        .table {
            background-color: #fff8d6;
            border-radius: 10px;
        }

        .table th {
            background-color: #f8d47e;
        }

        .form-label {
            font-weight: bold;
            font-size: 1.2rem;
        }

        .form-control, .form-select {
            border-radius: 12px;
            border: 2px solid #f4c542;
            background-color: #fffdf0;
        }

        .btn-success, .btn-primary {
            background: linear-gradient(45deg, #f4c542, #f1a900);
            border: none;
            font-size: 1.2rem;
        }

        .modal-content {
            background-color: #fff6cc;
            font-family: 'Poppins',sans-serif;
        }

        .modal-title {
            font-size: 1.6rem;
        }
    </style>
</head>
<body>


<div class="container">
    <h2>ğŸ§¾ ê²°ì œ ì •ë³´ í™•ì¸</h2>

    <div class="postit-board">
        <div class="card-body">
            <h4 class="card-title">ğŸ›ï¸ ì£¼ë¬¸ ë‚´ì—­</h4>
            <div class="table-responsive">
                <table class="table table-bordered text-center align-middle">
                    <thead>
                    <tr>
                        <th>ìƒí’ˆëª…</th>
                        <th>ìˆ˜ëŸ‰</th>
                        <th>ê°€ê²©</th>
                        <th>í•©ê³„</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="item : ${cartItems}">
                        <td th:text="${item.product.title}">ìƒí’ˆëª…</td>
                        <td th:text="${item.quantity}">ìˆ˜ëŸ‰</td>
                        <td th:text="${#numbers.formatInteger(item.product.price, 1, 'COMMA')} + 'ì›'">ê°€ê²©</td>
                        <td th:text="${#numbers.formatInteger(item.product.price * item.quantity, 1, 'COMMA')} + 'ì›'">í•©ê³„</td>
                    </tr>
                    </tbody>
                    <tfoot>
                    <tr>
                        <th colspan="3" class="text-end">ì´ ìƒí’ˆ ê¸ˆì•¡</th>
                        <th th:text="${#numbers.formatInteger(subtotal, 1, 'COMMA')} + 'ì›'">0ì›</th>
                    </tr>
                    <tr>
                        <th colspan="3" class="text-end">ë°°ì†¡ë¹„</th>
                        <th th:text="${#numbers.formatInteger(shippingCost, 1, 'COMMA')} + 'ì›'">0ì›</th>
                    </tr>
                    <tr class="table-warning">
                        <th colspan="3" class="text-end">ì´ ê²°ì œ ê¸ˆì•¡</th>
                        <th th:text="${#numbers.formatInteger(totalPrice, 1, 'COMMA')} + 'ì›'">0ì›</th>
                    </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>

    <div class="postit-board">
        <div class="card-body">
            <h4 class="card-title">ğŸšš ë°°ì†¡ ë° ê²°ì œ ì •ë³´</h4>
            <form method="post" th:action="@{/cart/confirm}">
                <div class="mb-3">
                    <label class="form-label">ìˆ˜ë ¹ì¸ ì´ë¦„</label>
                    <input type="text" class="form-control" name="receiverName" required>
                </div>

                <div class="mb-3">
                    <label class="form-label">ë°°ì†¡ ì£¼ì†Œ</label>
                    <input type="text" class="form-control" name="address" required>
                </div>

                <div class="mb-3">
                    <label class="form-label">ì—°ë½ì²˜</label>
                    <input type="tel" class="form-control" name="phone" required>
                </div>

                <div class="mb-3">
                    <label class="form-label">ë³´ìœ  í¬ì¸íŠ¸</label>
                    <input type="text" class="form-control" th:value="${points}" readonly>
                </div>

                <div class="mb-3">
                    <label class="form-label">ì‚¬ìš©í•  í¬ì¸íŠ¸</label>
                    <input type="number" class="form-control" name="usedPoints"
                           th:attr="max=${points}" min="0" value="0">
                </div>

                <div class="mb-3">
                    <label class="form-label">ê²°ì œ ìˆ˜ë‹¨</label>
                    <select class="form-select" name="paymentMethod" id="paymentMethod" required>
                        <option value="" disabled selected>ê²°ì œë°©ë²•ì„ ì„ íƒí•´ì£¼ì„¸ìš”</option>
                        <option value="card">ì‹ ìš©ì¹´ë“œ</option>
                        <option value="bank">ë¬´í†µì¥ ì…ê¸ˆ</option>
                    </select>
                </div>

                <!-- ì¹´ë“œ ì •ë³´ ì„¹ì…˜ -->
                <div id="cardPaymentSection" style="display: none;">
                    <div class="mb-3">
                        <label class="form-label">ì¹´ë“œ ì¢…ë¥˜</label>
                        <select class="form-select" name="cardType">
                            <option value="">ì¹´ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="hyundai">í˜„ëŒ€ì¹´ë“œ</option>
                            <option value="samsung">ì‚¼ì„±ì¹´ë“œ</option>
                            <option value="lotte">ë¡¯ë°ì¹´ë“œ</option>
                            <option value="shinhan">ì‹ í•œì¹´ë“œ</option>
                            <option value="kb">êµ­ë¯¼ì¹´ë“œ</option>
                            <option value="bc">ë¹„ì”¨ì¹´ë“œ</option>
                            <option value="nh">ë†í˜‘ì¹´ë“œ</option>
                            <option value="kakao">ì¹´ì¹´ì˜¤ë±…í¬</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">ì¹´ë“œ ë²ˆí˜¸</label>
                        <input type="text" class="form-control" name="cardNumber" id="cardNumber" maxlength="19" placeholder="ìˆ«ì 16ìë¦¬ ì…ë ¥">
                    </div>

                    <div class="mb-3 d-flex gap-2">
                        <input type="text" class="form-control" name="expiryMonth" placeholder="MM" maxlength="2">
                        <span class="align-self-center">/</span>
                        <input type="text" class="form-control" name="expiryYear" placeholder="YY" maxlength="2">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">ì¹´ë“œ ë¹„ë°€ë²ˆí˜¸ (ì• 2ìë¦¬)</label>
                        <input type="password" class="form-control" name="cardPassword" maxlength="2" placeholder="**">
                    </div>
                </div>

                <button type="submit" class="btn btn-success w-100 py-2 mt-3">ğŸ’³ ê²°ì œí•˜ê¸°</button>
            </form>
        </div>
    </div>
</div>

<!-- ëª¨ë‹¬ ë° JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const paymentMethodSelect = document.getElementById("paymentMethod");
        const cardSection = document.getElementById("cardPaymentSection");
        const cardNumberInput = document.getElementById("cardNumber");

        function toggleCardInputs() {
            if (paymentMethodSelect.value === "card") {
                cardSection.style.display = "block";
            } else {
                cardSection.style.display = "none";
            }

            if (paymentMethodSelect.value === "bank") {
                const today = new Date();
                const deadline = new Date(today);
                deadline.setDate(today.getDate() + 3);
                const year = deadline.getFullYear();
                const month = String(deadline.getMonth() + 1).padStart(2, '0');
                const day = String(deadline.getDate()).padStart(2, '0');
                document.getElementById("depositDeadline").innerText = `${year}-${month}-${day}`;
                const bankInfoModal = new bootstrap.Modal(document.getElementById('bankInfoModal'));
                bankInfoModal.show();
            }
        }

        paymentMethodSelect.addEventListener("change", toggleCardInputs);
        toggleCardInputs();

        cardNumberInput.addEventListener("input", function () {
            let value = this.value.replace(/\D/g, "");
            if (value.length > 16) value = value.slice(0, 16);
            const formatted = value.replace(/(\d{4})(?=\d)/g, "$1-");
            this.value = formatted;
        });
    });
</script>

<!-- ë¬´í†µì¥ ì…ê¸ˆ ëª¨ë‹¬ -->
<div class="modal fade" id="bankInfoModal" tabindex="-1" aria-labelledby="bankInfoModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="bankInfoModalLabel">ë¬´í†µì¥ ì…ê¸ˆ ì•ˆë‚´</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>ğŸ’³ ì…ê¸ˆ ê³„ì¢Œ: <strong>ë¶€ì‚°ì€í–‰ 1234-5678-1234-5678</strong></p>
                <p>ğŸ¦ ì˜ˆê¸ˆì£¼: <strong>ì£¼ì‹íšŒì‚¬ ë£¨í‹´</strong></p>
                <p>â° ì…ê¸ˆ ê¸°í•œ: <strong><span id="depositDeadline"></span>ê¹Œì§€</strong></p>
                <p><strong> â— í™•ì¸ í›„ ê¼­ ê²°ì œí•˜ê¸° ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì…”ì•¼ ì£¼ë¬¸ì´ ì§„í–‰ë©ë‹ˆë‹¤ â—</strong></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">í™•ì¸</button>
            </div>
        </div>
    </div>
</div>

</body>
</html>
